const { dataExistsAndMatches } = require("./dataExistsAndMatches")
const { getInfo } = require("./getInfo")

const { makeFakes } = require("make_fakes")
async function getTableBody(knex, table) {
    let getTableInfo = await getInfo(knex, table, "object")
    let keys = Object.keys(getTableInfo)
    let sampleObj = {}
    for (let i = 0; i < keys.length; i++) {
        // grab the value 
        let value = keys[i]
        let shouldBeType = getTableInfo[keys[i]];
        if (shouldBeType === "object") {
            sampleObj[keys[i]] = "date";
        } else {
            sampleObj[keys[i]] = shouldBeType
        }

    }
    return sampleObj
}

async function makeData(knex, table, number) {
    let getShape = await getTableBody(knex, table)
    let getFakes = makeFakes.createMany(getShape, number, true)
    return getFakes
}


async function postFakeData(knex, table, number) {
    let arr = []
    let getTake = await makeData(knex, table, number)
    for (let i = 0; i < getTake.length; i++) {
        let getArr = await knex(table).returning("*").insert(getTake[i])
        arr.push(getArr)
    }
    return arr;
}

module.exports = { postFakeData, getTableBody, makeData }